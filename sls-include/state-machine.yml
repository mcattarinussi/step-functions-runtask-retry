name: ecs-runtask-retry
definition:
  StartAt: RunECSTask
  States:
    RunECSTask:
      Type: Task
      Resource: "arn:aws:states:::ecs:runTask.sync"
      Parameters:
        LaunchType: FARGATE
        TaskDefinition:
          Ref: AppTaskDefinition
        NetworkConfiguration:
          AwsvpcConfiguration:
            AssignPublicIp: ENABLED
            Subnets:
              - ${opt:subnetId}
      End: true
      Catch:
        - ErrorEquals:
            - States.ALL
          ResultPath: "$.error"
          Next: HandleError
    HandleError:
      Type: Task
      Resource: { Fn::GetAtt: [errorHandler, Arn] }
      End: true
